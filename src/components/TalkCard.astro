---
/**
 * TalkCard Component
 * 
 * Displays a speaking engagement entry with comprehensive details including event information,
 * date, location, talk type, and optional links to slides and video recordings. Each talk type
 * has a distinct color-coded badge for easy visual identification.
 * 
 * Unlike other card components, TalkCard uses an article element instead of extending BaseCard
 * to accommodate the more complex layout requirements of speaking engagements.
 * 
 * @component
 * 
 * @example
 * ```astro
 * <TalkCard
 *   title="Building Scalable Design Systems"
 *   description="A deep dive into creating maintainable design systems for large teams"
 *   event="React Summit 2024"
 *   eventUrl="https://reactsummit.com"
 *   date={new Date('2024-06-15')}
 *   location="Amsterdam, Netherlands"
 *   type="conference"
 *   slides="https://slides.example.com/design-systems"
 *   video="https://youtube.com/watch?v=example"
 *   duration="45 min"
 *   topics={['design-systems', 'react', 'component-libraries']}
 *   featured={true}
 * />
 * ```
 */

interface Props {
  /** Talk title (displayed as card heading) */
  title: string;
  
  /** Brief description of the talk content */
  description: string;
  
  /** Name of the event or venue */
  event: string;
  
  /** Optional URL to the event website */
  eventUrl?: string;
  
  /** Date of the speaking engagement (formatted as "Month Year") */
  date: Date;
  
  /** Location of the event (city, country, or "Online") */
  location: string;
  
  /** Type of speaking engagement (determines badge color) */
  type: 'conference' | 'meetup' | 'podcast' | 'workshop' | 'webinar';
  
  /** Optional URL to presentation slides */
  slides?: string;
  
  /** Optional URL to video recording */
  video?: string;
  
  /** Optional duration of the talk (e.g., "45 min", "1 hour") */
  duration?: string;
  
  /** Optional array of topics covered in the talk */
  topics?: string[];
  
  /** Whether to display the featured badge (default: false) */
  featured?: boolean;
}

const { 
  title,
  description,
  event, 
  eventUrl, 
  date, 
  location, 
  type, 
  slides, 
  video, 
  duration,
  topics = [],
  featured = false 
} = Astro.props;

/**
 * Formats the talk date to show month and year only
 * 
 * Uses US English locale with long month format.
 * Example output: "June 2024"
 */
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long'
}).format(date);

/**
 * Human-readable labels for talk types
 * 
 * Maps internal type values to display labels shown in the badge.
 */
const typeLabels: Record<string, string> = {
  conference: 'Conference',
  meetup: 'Meetup',
  podcast: 'Podcast',
  workshop: 'Workshop',
  webinar: 'Webinar'
};
---

<article class="talk-card">
  {featured && (
    <span class="featured-badge">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
      </svg>
      Featured
    </span>
  )}
  
  <div class="talk-meta">
    <span class="talk-type" data-type={type}>{typeLabels[type]}</span>
    <span class="talk-date">{formattedDate}</span>
  </div>
  
  <h3 class="talk-title">{title}</h3>
  
  <p class="talk-description">{description}</p>
  
  <div class="talk-event">
    {eventUrl ? (
      <a href={eventUrl} target="_blank" rel="noopener noreferrer" class="event-link">
        {event}
        <svg class="external-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
          <polyline points="15 3 21 3 21 9"></polyline>
          <line x1="10" y1="14" x2="21" y2="3"></line>
        </svg>
      </a>
    ) : (
      <span>{event}</span>
    )}
    <span class="talk-location">· {location}</span>
    {duration && <span class="talk-duration">· {duration}</span>}
  </div>
  
  {topics.length > 0 && (
    <div class="tags-list">
      {topics.map((topic) => (
        <span class="tag">{topic}</span>
      ))}
    </div>
  )}
  
  {(slides || video) && (
    <div class="talk-links">
      {slides && (
        <a href={slides} target="_blank" rel="noopener noreferrer" class="talk-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
          </svg>
          Slides
        </a>
      )}
      {video && (
        <a href={video} target="_blank" rel="noopener noreferrer" class="talk-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          Video
        </a>
      )}
    </div>
  )}
</article>

<style>
  .talk-card {
    position: relative;
    padding: 1.5rem 1.75rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    transition: border-color 0.2s ease, background 0.2s ease;
  }

  .talk-card:hover {
    border-color: var(--color-text-muted);
    background: var(--color-bg-elevated);
  }

  .featured-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-accent);
    margin-bottom: 0.75rem;
  }

  .featured-badge svg {
    flex-shrink: 0;
  }

  .talk-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .talk-type {
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
  }

  .talk-type[data-type="conference"] {
    color: var(--color-accent);
    border-color: var(--color-accent);
  }

  .talk-type[data-type="meetup"] {
    color: #10b981;
    border-color: #10b981;
  }

  .talk-type[data-type="podcast"] {
    color: #8b5cf6;
    border-color: #8b5cf6;
  }

  .talk-type[data-type="workshop"] {
    color: #f59e0b;
    border-color: #f59e0b;
  }

  .talk-type[data-type="webinar"] {
    color: #ec4899;
    border-color: #ec4899;
  }

  .talk-date {
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }

  .talk-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  .talk-description {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: 0.75rem;
  }

  .talk-event {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    margin-bottom: 1rem;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.25rem;
  }

  .event-link {
    color: var(--color-text-secondary);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    transition: color 0.2s ease;
  }

  .event-link:hover {
    color: var(--color-accent);
  }

  .external-icon {
    opacity: 0.6;
  }

  .talk-location,
  .talk-duration {
    color: var(--color-text-muted);
  }

  .talk-links {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border);
  }

  .talk-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-accent);
    text-decoration: none;
    transition: opacity 0.2s ease;
  }

  .talk-link:hover {
    opacity: 0.8;
  }

  .talk-link svg {
    flex-shrink: 0;
  }

  @media (max-width: 640px) {
    .talk-card {
      padding: 1.25rem 1.5rem;
    }

    .talk-title {
      font-size: 1rem;
    }

    .talk-event {
      font-size: 0.875rem;
    }

    .talk-links {
      gap: 0.75rem;
    }
  }
</style>
