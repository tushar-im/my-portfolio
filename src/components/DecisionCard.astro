---
/**
 * DecisionCard Component
 * 
 * Displays a decision log entry in a card format with title, context, date, and tags.
 * Extends BaseCard component with decision-specific formatting. Context text is
 * automatically truncated to maintain consistent card heights.
 * 
 * @component
 * 
 * @example
 * ```astro
 * <DecisionCard
 *   title="Migrate to TypeScript"
 *   slug="migrate-to-typescript"
 *   context="After evaluating the benefits of type safety and developer experience..."
 *   date={new Date('2024-03-15')}
 *   tags={['architecture', 'typescript', 'dx']}
 *   maxContextLength={200}
 * />
 * ```
 */

import BaseCard from './BaseCard.astro';
import ForwardLink from './ForwardLink.astro';

interface Props {
  /** Decision title (displayed as card heading) */
  title: string;
  
  /** URL slug for the decision (used to generate /decisions/{slug} link) */
  slug: string;
  
  /** Decision context or rationale (automatically truncated if too long) */
  context: string;
  
  /** Decision date (formatted as "Month Year") */
  date: Date;
  
  /** Optional array of tags/categories for the decision */
  tags?: string[];
  
  /** Maximum character length for context before truncation (default: 180) */
  maxContextLength?: number;
}

const { title, slug, context, date, tags = [], maxContextLength = 180 } = Astro.props;

/**
 * Formats a date object to show month and year only
 * 
 * Uses US English locale with long month format.
 * Example output: "March 2024"
 * 
 * @param date - The date to format
 * @returns Formatted date string in "Month Year" format
 */
function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long'
  }).format(date);
}

/**
 * Truncates text to a maximum length with ellipsis
 * 
 * If text is shorter than maxLength, returns original text unchanged.
 * Trims whitespace before adding ellipsis.
 * 
 * @param text - The text to truncate
 * @param maxLength - Maximum character length
 * @returns Truncated text with "..." or original text if under limit
 */
function truncate(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength).trim() + '...';
}

const truncatedContext = truncate(context, maxContextLength);
---

<BaseCard href={`/decisions/${slug}`} class="decision-card">
  <Fragment slot="meta">{formatDate(date)}</Fragment>
  <Fragment slot="title">{title}</Fragment>
  <Fragment slot="description">{truncatedContext}</Fragment>
  
  {tags.length > 0 && (
    <div slot="tags" class="tags-list">
      {tags.map((tag) => (
        <span class="tag">{tag}</span>
      ))}
    </div>
  )}
  
  <ForwardLink text="Read decision" />
</BaseCard>
