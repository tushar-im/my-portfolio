---
/**
 * Uses Page
 * 
 * Documents the tools, technologies, and environment used in the development workflow.
 * Provides transparency about the technical stack and helps other engineers discover
 * useful tools while understanding the technical context.
 * 
 * Features:
 * - Queries all uses entries from content collection
 * - Sorts by custom order field for intentional presentation
 * - Groups items by category (tools, stack, environment)
 * - Displays category headers with descriptions
 * - Shows items with name, description, and optional external links
 * - External link indicators for referenced tools
 * - Empty state handling
 * 
 * Categories:
 * - tools: Software and applications used daily
 * - stack: Technologies and frameworks worked with
 * - environment: Hardware and workspace setup
 * 
 * Route: /uses
 * 
 * @page
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import SEO from '../components/SEO.astro';
import { getCollection } from 'astro:content';
import { pagesConfig } from '../pages.config';

/**
 * Queries all uses entries from the content collection
 */
const allUses = await getCollection('uses');

/**
 * Sorts uses entries by custom order field
 * 
 * Allows intentional curation of which tools/technologies are highlighted
 * first within each category.
 */
const sortedUses = allUses.sort((a, b) => a.data.order - b.data.order);

/**
 * Groups uses entries by category
 * 
 * Creates a record object where keys are category names (tools, stack, environment)
 * and values are arrays of entries in that category. This enables category-based
 * section organization in the UI.
 * 
 * @returns Record with category as key and array of entries as value
 */
const groupedByCategory = sortedUses.reduce((acc, entry) => {
  const category = entry.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(entry);
  return acc;
}, {} as Record<string, typeof sortedUses>);

/**
 * Category metadata for display
 * 
 * Defines the title and description for each category section,
 * providing context about what each category contains.
 */
const categoryInfo = {
  tools: { title: 'Tools', description: 'Software and applications I use daily' },
  stack: { title: 'Tech Stack', description: 'Technologies and frameworks I work with' },
  environment: { title: 'Environment', description: 'Hardware and workspace setup' },
};

/**
 * Defines the display order for categories
 * 
 * Ensures categories appear in a logical progression: tools → stack → environment
 */
const categoryOrder: Array<'tools' | 'stack' | 'environment'> = ['tools', 'stack', 'environment'];
---

<BaseLayout>
  <SEO 
    slot="head"
    title={pagesConfig.uses.title}
    description={pagesConfig.uses.description}
    type="website"
  />

  <main class="page-container">
    <header class="page-header">
      <h1 class="page-title">{pagesConfig.uses.heading}</h1>
      <p class="page-intro">
        {pagesConfig.uses.intro}
      </p>
    </header>

    {categoryOrder.map((categoryKey) => {
      const entries = groupedByCategory[categoryKey];
      if (!entries || entries.length === 0) return null;

      const info = categoryInfo[categoryKey];

      return (
        <section class="category-section">
          <div class="category-header">
            <h2>{info.title}</h2>
            <p class="category-description">{info.description}</p>
          </div>

          <div class="items-list">
            {entries.map((entry) => (
              entry.data.items.map((item) => (
                <div class="item">
                  <h3 class="item-name">
                    {item.url ? (
                      <a href={item.url} target="_blank" rel="noopener noreferrer">
                        {item.name}
                        <span class="external-link-icon" aria-hidden="true">↗</span>
                      </a>
                    ) : (
                      item.name
                    )}
                  </h3>
                  <p class="item-description">{item.description}</p>
                </div>
              ))
            ))}
          </div>
        </section>
      );
    })}

    {sortedUses.length === 0 && (
      <p class="empty-state">No uses documented yet.</p>
    )}
  </main>

  <style>
    .category-section {
      margin-bottom: 4rem;
    }

    .category-section:last-of-type {
      margin-bottom: 2rem;
    }

    .category-header {
      margin-bottom: 2rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--color-border);
    }

    .category-header h2 {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .category-description {
      font-size: 1rem;
      color: var(--color-text-secondary);
      margin: 0;
    }

    .items-list {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .item-name {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .item-name a {
      color: var(--color-text);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      transition: color 0.2s ease;
    }

    .item-name a:hover {
      color: var(--color-accent);
    }

    .external-link-icon {
      font-size: 0.875rem;
      opacity: 0.6;
    }

    .item-description {
      font-size: 1rem;
      line-height: 1.6;
      color: var(--color-text-secondary);
      margin: 0;
    }

    @media (max-width: 768px) {
      .category-header h2 {
        font-size: 1.5rem;
      }

      .item-name {
        font-size: 1.125rem;
      }

      .items-list {
        gap: 1.5rem;
      }
    }
  </style>
</BaseLayout>
