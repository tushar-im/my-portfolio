---
/**
 * Decisions Index Page
 * 
 * Lists all decision log entries in reverse chronological order (most recent first).
 * Provides a transparent view of architectural and technical decisions made throughout
 * the career, with each entry linking to its detailed decision record.
 * 
 * Features:
 * - Queries all decisions from content collection
 * - Sorts by date (descending - newest first)
 * - Displays decision count statistics
 * - Uses DecisionCard component for consistent presentation
 * - SEO optimization
 * - Empty state handling
 * 
 * Route: /decisions
 * 
 * @page
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import SEO from '../../components/SEO.astro';
import DecisionCard from '../../components/DecisionCard.astro';
import PageStats from '../../components/PageStats.astro';
import { getCollection } from 'astro:content';
import { pagesConfig } from '../../pages.config';

/**
 * Queries all decisions from the content collection
 */
const allDecisions = await getCollection('decisions');

/**
 * Sorts decisions by date in descending order (most recent first)
 * 
 * Ensures the latest decisions appear at the top of the list for
 * easy access to recent architectural choices.
 */
const sortedDecisions = allDecisions.sort((a, b) => {
  return b.data.date.getTime() - a.data.date.getTime();
});

/**
 * Total count of documented decisions for statistics display
 */
const totalDecisions = sortedDecisions.length;
---

<BaseLayout>
  <SEO 
    slot="head"
    title={pagesConfig.decisions.title}
    description={pagesConfig.decisions.description}
    type="website"
  />

  <main class="page-container">
    <header class="page-header">
      <h1 class="page-title">{pagesConfig.decisions.heading}</h1>
      <p class="page-intro">
        {pagesConfig.decisions.intro}
      </p>
      <PageStats text={`${totalDecisions} decisions documented`} />
    </header>

    {sortedDecisions.length > 0 ? (
      <div class="card-list card-list--compact">
        {sortedDecisions.map((decision) => (
          <DecisionCard
            title={decision.data.title}
            slug={decision.id}
            context={decision.data.context}
            date={decision.data.date}
            tags={decision.data.tags}
          />
        ))}
      </div>
    ) : (
      <p class="empty-state">No decisions documented yet.</p>
    )}
  </main>
</BaseLayout>
